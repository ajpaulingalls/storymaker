<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1080, height=1920" />
    <title>Story</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="/shared/base.css" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Noto+Sans+Arabic:wght@400;500;600;700;800&family=Montserrat:wght@400;500;600;700;800&display=swap");

      :root {
        --accent-color: #fa9000;
        --accent-color-alt: #e76f51;
        --live-updates-color: #BF3640;
        --font-arabic: "Noto Sans Arabic";
        --font-body: "Montserrat";
      }

      body {
        background: #0a0a0a;
      }

      body.rtl {
        font-family: var(--font-arabic), var(--font-body), sans-serif;
      }

      /* Site-specific font overrides for aje */
      body.site-aje {
        --font-body: "Montserrat";
      }

      body.site-aje .loading-text {
        font-family: "Montserrat", sans-serif;
      }

      .loading-text {
        font-family: "Roboto", sans-serif;
      }

      /* Background Image */
      .bg-image-container {
        direction: ltr;
      }

      /* Background Image - Horizontal Pan Effect */
      .bg-image {
        height: 100%;
        width: auto;
        opacity: 0;
        will-change: transform, opacity;
        animation: fadeInImage 1s ease-out forwards;
      }

      @keyframes fadeInImage {
        0% { opacity: 0; }
        100% { opacity: 1; }
      }

      @keyframes panLeftToRight {
        0% { transform: translateX(0); }
        100% { transform: translateX(var(--pan-distance)); }
      }

      @keyframes panRightToLeft {
        0% { transform: translateX(var(--pan-distance)); }
        100% { transform: translateX(0); }
      }

      /* Dark overlay covering bottom half - solid semi-transparent box */
      .overlay {
        position: absolute;
        top: 1220px; /* Start around waist/middle level */
        left: 60px;
        width: 860px;
        height: 700px; /* Shorter height */
        background: rgba(20, 20, 20, 0.8); /* Dark, desaturated gray with ~80% opacity */
        border-radius: 0 90px 0 0; /* Rounded top-right corner */
        opacity: 0;
        animation: fadeInOverlay 0.5s ease-out 1s forwards;
      }

      @keyframes fadeInOverlay {
        to {
          opacity: 1;
        }
      }

      /* Al Jazeera Logo - top-left */
      .logo-area {
        position: absolute;
        top: 60px;
        left: 80px;
        z-index: 20;
        opacity: 0;
        animation: fadeIn 0.6s ease-out 0.5s forwards;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }

      .logo-icon {
        width: 120px;
        height: 120px;
      }

      .logo-icon svg {
        width: 100%;
        height: 100%;
      }

      /* Logo text container with white outline */
      .logo-text-container {
        padding: 6px 10px;
        border: 2px solid white;
        display: inline-block;
      }

      .logo-text {
        font-family: "Roboto", sans-serif;
        font-size: 24px;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      body.site-aje .logo-text {
        font-family: "Montserrat", sans-serif;
      }

      body.rtl .logo-area {
        left: auto;
        right: 80px;
      }

      body.rtl .logo-text {
        letter-spacing: 0;
        font-family: var(--font-arabic), var(--font-body), sans-serif;
      }

      /* Location Indicator - top-right, aligned with logo text */
      .location-indicator {
        position: absolute;
        top: 192px; /* Aligned with logo text: 60px (logo top) + 120px (icon height) + 12px (gap) */
        right: 80px;
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 20;
        opacity: 0;
        animation: fadeIn 0.6s ease-out 0.8s forwards;
      }

      body.rtl .location-indicator {
        right: auto;
        left: 80px;
        flex-direction: row-reverse;
      }

      .location-text {
        font-family: "Roboto", sans-serif;
        font-size: 28px;
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: white;
      }

      body.site-aje .location-text {
        font-family: "Montserrat", sans-serif;
      }

      body.rtl .location-text {
        letter-spacing: 0;
        font-family: var(--font-arabic), var(--font-body), sans-serif;
      }

      .location-pin {
        width: 36px;
        height: 36px;
        fill: white;
      }

      /* Source Watermark - vertical text on left edge */
      .source-watermark {
        position: absolute;
        left: 80px;
        top: 640px; /* Approximately 1/3 down from top */
        writing-mode: vertical-rl;
        text-orientation: mixed;
        font-family: "Roboto", sans-serif;
        font-size: 24px;
        font-weight: 400;
        color: white;
        letter-spacing: 4px;
        opacity: 0;
        animation: fadeIn 0.6s ease-out 1s forwards;
        z-index: 15;
        text-transform: uppercase;
      }

      body.site-aje .source-watermark {
        font-family: "Montserrat", sans-serif;
      }

      body.rtl .source-watermark {
        left: auto;
        right: 80px;
        letter-spacing: 0;
        font-family: var(--font-arabic), var(--font-body), sans-serif;
      }

      /* Content wrapper for LIVE UPDATES and headline */
      .content-wrapper {
        position: absolute;
        top: 1180px;
        left: 100px;
        right: 100px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        z-index: 20;
      }

      body.rtl .content-wrapper {
        left: auto;
        right: 80px;
      }

      /* LIVE UPDATES Tag */
      .live-updates-tag {
        opacity: 0;
        transform: translateX(-30px);
        animation: slideRight 0.5s ease-out 1.5s forwards;
      }

      body.rtl .live-updates-tag {
        transform: translateX(30px);
        direction: ltr; /* Keep text direction LTR for LIVE UPDATES tag */
        animation: slideLeft 0.5s ease-out 1.5s forwards;
      }

      @keyframes slideLeft {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .live-updates-box {
        display: inline-block;
        background: white;
        color: var(--live-updates-color);
        padding: 5px 15px;
        font-family: "Montserrat", sans-serif;
        font-size: 60px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 3px;
      }

      body.site-aje .live-updates-box {
        font-family: "Montserrat", sans-serif;
        font-weight: 800; /* Extra bold */
      }

      body.rtl .live-updates-box {
        letter-spacing: 0;
        font-family: var(--font-arabic), var(--font-body), sans-serif;
      }

      /* Main Content Area */
      .content {
        padding: 0;
        z-index: 20;
      }

      body.rtl .content {
        direction: rtl;
        text-align: right;
      }

      /* Headline */
      .headline {
        font-family: "Roboto", sans-serif;
        font-size: 76px;
        font-weight: 900;
        line-height: 1.15;
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 30px;
        max-width: 920px;
        opacity: 0;
        transform: translateY(40px);
        animation: slideUp 0.8s ease-out 2s forwards;
      }

      body.site-aje .headline {
        font-family: "Montserrat", sans-serif;
        font-weight: 800; /* Extra bold */
      }

      body.rtl .headline {
        letter-spacing: 0;
        font-family: var(--font-arabic), var(--font-body), sans-serif;
        text-transform: none;
      }

      .headline-word {
        display: inline-block;
        margin-right: 0.15em;
        white-space: pre;
      }

      .headline .headline-word.highlight {
        color: var(--live-updates-color) !important;
      }

      /* Status badge - hidden, we use custom LIVE UPDATES tag */
      .status-badge {
        display: none !important;
      }

      /* Image credit */
      .image-credit {
        position: absolute;
        bottom: 40px;
        right: 80px;
        font-family: "Roboto", sans-serif;
        font-size: 20px;
        color: rgba(255, 255, 255, 0.5);
        opacity: 0;
        animation: fadeIn 0.5s ease-out 3s forwards;
        z-index: 20;
      }

      body.site-aje .image-credit {
        font-family: "Montserrat", sans-serif;
      }

      body.rtl .image-credit {
        right: auto;
        left: 80px;
      }
    </style>
  </head>
  <body>
    <!-- Loading State -->
    <div class="loading-container" id="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading story...</div>
    </div>

    <!-- Background Image -->
    <div class="bg-image-container">
      <img class="bg-image" id="bgImage" alt="" />
    </div>

    <!-- Overlay -->
    <div class="overlay"></div>

    <!-- Al Jazeera Logo -->
    <div class="logo-area">
      <div class="logo-icon" id="logoIcon"></div>
      <div class="logo-text-container">
        <div class="logo-text" id="logoText"></div>
      </div>
    </div>

    <!-- Location Indicator -->
    <div class="location-indicator">
      <div class="location-text" id="location"></div>
      <svg class="location-pin" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    </div>

    <!-- Source Watermark -->
    <div class="source-watermark" id="sourceWatermark"></div>

    <!-- Content Wrapper (LIVE UPDATES + Headline) -->
    <div class="content-wrapper">
      <!-- LIVE UPDATES Tag -->
      <div class="live-updates-tag">
        <div class="live-updates-box" id="liveUpdatesTag">LIVE UPDATES</div>
      </div>

      <!-- Main Content -->
      <div class="content">
        <h1 class="headline" id="headline"></h1>
      </div>
    </div>

    <!-- Image Credit -->
    <div class="image-credit" id="imageCredit"></div>

    <script src="/shared/story.js"></script>
    <script src="/shared/components.js"></script>
    <script>
      const SC = window.StoryComponents;

      /**
       * Generate icon-only Al Jazeera logo (white shape, no text)
       * Returns just the white shape part without colored background
       */
      function getIconOnlyLogo(site) {
        // Both AJE and AJA use the same white shape icon
        // Return just the white shape path (no colored square background)
        return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60">
          <g fill="none">
            <path
              d="M34.13 48.03c-.07.03-.1.16-.05.33l.33.87c.2.53.52 1.15.97 1.46.47.34.72.22.82.18.07-.04.37-.22.26-.7a2.99 2.99 0 00-.27-.85c-.1-.18-.22-.3-.3-.27-.04 0 0 .18 0 .28 0 .2-.07.33-.23.4-.14.06-.48.18-.74-.28-.22-.38-.4-.87-.49-1.08-.06-.15-.16-.34-.26-.34h-.04zm-7.47 1.38l1.59 1.32 1.54-1.87-1.59-1.32-1.54 1.87zm.35-3.26l1.59 1.31 1.55-1.86-1.6-1.32-1.54 1.87zm10.14-4.6l1.87.88 1.03-2.2-1.86-.88-1.04 2.2zM27.5 40a12.75 12.75 0 003.36 4.63c.14-.97.3-1.65.44-2.13-1.4-1-2.4-2.1-3.05-3.18l-.75.68zm3.54-2.35l1.86.88 1.04-2.2-1.87-.88-1.03 2.2zm-9-8.75s-1.17.83-1.64 1.92a2.4 2.4 0 00-.1 1.75c.16.35.55.68 1.06.28.35-.28.5-.68.58-1.01.05-.2.06-.33.06-.43 0-.12-.04-.22-.15-.2-.34.11-.14.57-.38.79-.18.1-.66.05-.75-.42-.1-.47.27-1.07.6-1.47.32-.4.9-.92.9-.92s.4-.34.27-.51l-.04-.01c-.12 0-.41.23-.41.23zM33.5 27.7l-1.44 1.57-1.24 1.35c-.27.3-.41.6-.38.76l.17.82c.04-.15.22-.43.4-.64.14-.15.8-.89 1.45-1.58l1.23-1.35c.27-.3.41-.6.38-.76l-.17-.81c-.04.15-.21.42-.4.64zM17.97 39.53c.22-.72.64-1.37 1.35-1.78 1.18-.55 1.64.86 1.64.86-.08.95-.8 1.45-1.61 1.45-.47 0-.98-.17-1.38-.53zm8.75-22.88a1.45 1.45 0 101.16 2.38l.03-.04c.17 1.16-.38 2.08-1.67 3.15-1.31 1.12-4.4 2.56-6.58 4.3a9.8 9.8 0 00-3.68 10.51 13.93 13.93 0 00.86 2.44 14.3 14.3 0 00.87 5.79c1.08 2.42 3.01 4.4 5.79 3.82 2.8-.66 3.12-5.22 3.43-8.55.09-.55.17-.65.34-.79.45-.38 1.54-1.4 2.06-1.86.32-.29.6-.57.79-.94.23-.44.1-1.02.1-1.02l-.3-2.2c-.09.31-.47.75-1 1.29-.56.56-2.05 1.84-2.19 1.98-.13.14-.61.5-.82 2.17-.54 4.55-1.43 6.7-3.04 7.43-.43.2-.9.3-1.43.3-2.95-.02-3.73-3.62-3.72-5.59 0-.12 0-.24.02-.34.68.92 1.7 1.84 2.94 1.65 2-.3 1.37-3.67 1.08-4.45-.28-.78-1.05-3.13-2.72-3.01-1.18.08-1.73 1.47-1.99 2.64a9.49 9.49 0 01-.27-2.86c.17-2.04.87-4.58 3.83-7.08 2.1-1.78 4.5-3.06 5.82-4.1a5.35 5.35 0 001.66-2.12 9.58 9.58 0 01-.57 2.27c-1.23 3.23-4.95 8.57-5 16.1 0 2.32.22 4.32.59 6.03.2-.13.39-.32.57-.53-.26-1.23-.4-2.58-.4-4.03 0-7.52 3.69-12.84 4.89-16.07.63-1.7.65-2.93.65-4.15 0-1.5-.34-3.07-.65-3.68-.34-.58-.75-.84-1.38-.84h-.07zm3.63-10.3c-.74.51-1.36 1.7-1.36 3.5 0 1.1.32 2.43 1.17 3.92-1.15 1.56-1.36 3-.87 4.38.37 1.05.56 1.32.73 1.95.42 1.6-.05 3.5-1.3 6.46-1.02 2.4-2.35 4.92-2.35 7.98 0 .7.07 1.39.17 2.06.11-.12.37-.35.67-.64-.15-2.4.8-4.81 1.98-6.98 1.7-3.17 1.92-6.39 1.59-8.15 1.2 1.28 3.22 3.2 4.4 5.16.4.66.64 1.29.7 1.93a5.04 5.04 0 01-1.39 3.76c-.8.92-.53 1.73-.5 1.9.07.25.4 1.26.63 1.91.9-1.75 3.36-2.73 4.48-4.19.25 1.8-1.1 3.5-2.1 4.64-.23.26-.5.52-.79.8-1.9 1.82-3.14 3.06-3.8 4.22-.16.26-.44.83-.57 1.27-.2.56-.44 1.5-.65 3.15a75.6 75.6 0 00-.39 2.66c-.13 1.19-.48 3.06-1.94 3.6-.07.03-.15.05-.23.06v.01c-1.39.3-2.8-.86-3.83-2.94-.22.16-.45.3-.7.42 1.4 3.3 3.5 4.81 5.33 4.81 1.4 0 2.5-.7 2.85-2.75.18-1.03.31-2.18.43-3.29.06-.53.32-3.55.8-4.65.6-1.23 1.92-2.41 3.88-4.43 1.2-1.25 1.87-2.3 2.21-3.14 1.14-2.08-.27-7.04-.55-7.94 0-.03 0-.04-.03-.04-.02 0-.03.01-.05.05l-.01.02c-.5.82-1.4 1.57-2.25 2.18.48-1.29.35-2.27.16-3.1l-.04-.15c-.85-3.29-4.21-6.22-5.73-7.9-1.98-2.2-1.3-3.6-.58-4.5l.44.63c2.69 3.64 7.74 9.41 10.4 14.91a18.44 18.44 0 011.46 4.06c1.05 5.7-2.93 11.49-8.9 9.86l-.11-.03c-.16.5-.31 1.31-.46 2.41.9.39 1.88.62 2.83.66h.21c4.9.06 8.73-3.6 8.03-11.3 0 0-.3-3.2-1.95-6.58-2.65-5.92-7.56-11.78-10.57-15.57a10.04 10.04 0 01-1.8-3.14c-.56-1.75-.2-3.11.52-3.7.16-.13.35-.28.53-.37.1-.06.06-.18-.01-.2h-.07c-.1 0-.3.05-.72.34zm-5.5 12.8c-.8.02-1.44.69-1.41 1.5a1.45 1.45 0 102.9-.1 1.45 1.45 0 00-1.45-1.4h-.05z"
              fill="#FFF"
            ></path>
          </g>
        </svg>`;
      }

      /**
       * Parse headline and highlight key words
       * Looks for action words, important verbs, and critical terms
       */
      function parseHeadline(text) {
        const words = text.split(' ');
        // Common words to highlight in live updates (action words, critical terms)
        const highlightedWords = [
          'SHELTER', 'SHELT', 'URGES', 'URGE', 'WARNS', 'WARN', 'ALERTS', 'ALERT',
          'BREAKING', 'CRITICAL', 'IMMEDIATE', 'EVACUATE', 'EVACUATION',
          'ATTACK', 'ATTACKED', 'BOMB', 'BOMBING', 'STRIKE', 'STRIKES',
          'DEATH', 'DEATHS', 'KILLED', 'INJURED', 'CASUALTIES'
        ];
        
        const parsedWords = words.map(word => {
          // Remove punctuation for matching
          const cleanWord = word.toUpperCase().replace(/[^\w]/g, '');
          const isHighlighted = highlightedWords.some(hw => 
            cleanWord === hw || cleanWord.startsWith(hw) || cleanWord.includes(hw)
          );
          return {
            text: word,
            highlight: isHighlighted
          };
        });
        
        // Ensure at least one word is highlighted (highlight longest word if none match)
        const hasHighlight = parsedWords.some(w => w.highlight);
        if (!hasHighlight && parsedWords.length > 0) {
          // Find the longest word (by character length, excluding punctuation)
          let longestIndex = 0;
          let longestLength = parsedWords[0].text.replace(/[^\w]/g, '').length;
          
          parsedWords.forEach((word, index) => {
            const cleanLength = word.text.replace(/[^\w]/g, '').length;
            if (cleanLength > longestLength) {
              longestLength = cleanLength;
              longestIndex = index;
            }
          });
          
          parsedWords[longestIndex].highlight = true;
        }
        
        return parsedWords;
      }

      /**
       * Render headline with highlighted words
       */
      function renderHeadline(text, container, isRTL = false) {
        if (!text || !container) return;
        
        const words = parseHeadline(text);
        container.innerHTML = '';
        
        // For RTL, reverse the word order
        const wordsToRender = isRTL ? [...words].reverse() : words;
        
        wordsToRender.forEach((word, index) => {
          const span = document.createElement('span');
          const classes = ['headline-word'];
          if (word.highlight) {
            classes.push('highlight');
          }
          span.className = classes.join(' ');
          
          // For RTL, add space before word (except first), for LTR add space after (except last)
          if (isRTL) {
            span.textContent = (index > 0 ? ' ' : '') + word.text;
          } else {
            span.textContent = word.text + (index < wordsToRender.length - 1 ? ' ' : '');
          }
          container.appendChild(span);
        });
      }

      async function renderContent(articleData) {
        SC.hideLoading();
        SC.applyAccentColors(articleData);
        
        // Add site-specific class to body
        if (articleData.site === "aje") {
          document.body.classList.add("site-aje");
        }
        
        // Insert icon-only logo (white shape)
        const logoIcon = document.getElementById("logoIcon");
        if (logoIcon) {
          logoIcon.innerHTML = getIconOnlyLogo(articleData.site || "aje");
        }
        
        // Set logo text
        const logoText = document.getElementById("logoText");
        if (logoText) {
          if (articleData.isRTL) {
            logoText.textContent = "الجزيرة";
          } else {
            logoText.textContent = "ALJAZEERA";
          }
        }
        
        // Set source watermark
        const sourceWatermark = document.getElementById("sourceWatermark");
        if (sourceWatermark && articleData.source) {
          sourceWatermark.textContent = articleData.source.toUpperCase();
        }
        
        // Set location
        SC.setText("location", articleData.location || articleData.category || "");
        
        // Set LIVE UPDATES tag text based on article status
        const liveUpdatesTag = document.getElementById("liveUpdatesTag");
        if (articleData.isRTL) {
          if (articleData.isLive) {
            liveUpdatesTag.textContent = "مباشر";
          } else if (articleData.isBreaking) {
            liveUpdatesTag.textContent = "عاجل";
          } else if (articleData.isDeveloping) {
            liveUpdatesTag.textContent = "متابعة";
          } else {
            liveUpdatesTag.textContent = "تحديثات مباشرة";
          }
        } else {
          if (articleData.isLive) {
            liveUpdatesTag.textContent = "LIVE";
          } else if (articleData.isBreaking) {
            liveUpdatesTag.textContent = "BREAKING";
          } else if (articleData.isDeveloping) {
            liveUpdatesTag.textContent = "DEVELOPING";
          } else {
            liveUpdatesTag.textContent = "LIVE UPDATES";
          }
        }
        
        // Render headline with highlighting
        renderHeadline(articleData.title, document.getElementById("headline"), articleData.isRTL);
        
        // Set image credit
        SC.setImageCredit("imageCredit", articleData.imageCredit, articleData.isRTL);

        // Set background image and setup pan animation
        if (articleData.imageUrl) {
          const bgImage = document.getElementById("bgImage");
          bgImage.src = articleData.imageUrl;
          
          await new Promise((resolve) => {
            bgImage.onload = () => {
              const viewportWidth = 1080;
              const panDistance = -(bgImage.offsetWidth - viewportWidth);
              bgImage.style.setProperty("--pan-distance", `${panDistance}px`);
              // For RTL (Arabic), pan from right to left - start positioned at right side
              const panAnimation = articleData.isRTL ? "panRightToLeft" : "panLeftToRight";
              if (articleData.isRTL) {
                // Set initial position to show right side of image before animation starts
                bgImage.style.transform = `translateX(${panDistance}px)`;
              }
              setTimeout(() => {
                bgImage.style.animation = `fadeInImage 0.5s ease-out forwards, ${panAnimation} 10s linear forwards`;
              }, 100);
              resolve();
            };
            bgImage.onerror = resolve;
          });
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        window.StoryMaker.initStory({ renderContent });
      });
    </script>
  </body>
</html>
